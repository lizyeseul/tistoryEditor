<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="post-list">

	<delete id="deletePosts">
	/*deletePosts*/
	DELETE FROM post_list
	WHERE BLOG_UUID = #{blog_uuid}
	</delete>
	<insert id="insertPost">
	/*insertPost*/
	INSERT INTO post_list
	(
		POST_UUID,
		POST_ID,
		BLOG_UUID,
		CTGY_UUID,
		POST_NM,
		POST_URL,
		PUBLIC_CD,
		POST_DT,
		STAT_COMNT,
		STAT_TRKBK
	)
	SELECT 
		#{post_uuid},
		#{id},
		#{blog_uuid},
		CTGY_UUID,
		#{title},
		#{postUrl},
		#{visibility},
		#{date},
		#{comments},
		#{trackbacks}
	  FROM category_list
	 WHERE 1=1
	   AND CTGY_ID = #{categoryId}
	</insert>
	<sql id="selectPostListMain">
	/*selectPostListMain*/
	SELECT
		POST_UUID,
		POST_ID,
		BLOG_UUID,
		CTGY_UUID,
		POST_NM,
		POST_URL,
		PUBLIC_CD,
		POST_DT,
		STAT_COMNT,
		STAT_TRKBK
	FROM  post_list
	WHERE 1=1
	AND BLOG_UUID = #{blog_uuid}
	<if test='ctgy_uuid != "all"'>
	AND find_in_set(CTGY_UUID, fn_ctgy_list(#{ctgy_uuid})) > 0
	</if>
	ORDER BY POST_DT DESC
	</sql>
	<select id="selectPostListAll" resultType="map">
	/*selectPostListAll*/
	<include refid="selectPostListMain"></include>
	</select>
	<select id="selectPostList" resultType="map">
	/*selectPostList*/
SELECT R1.* FROM (
	<include refid="selectPostListMain"></include>
) R1
LIMIT #{post_per_page, jdbcType=INTEGER} OFFSET #{offset, jdbcType=INTEGER}
	</select>
	<select id="selectPostIdByUuid" resultType="map">
	/*selectPostIdByUuid*/
	SELECT POST_ID
	FROM post_list
	WHERE 1=1
	AND POST_UUID = #{post_uuid}
	</select>
	<select id="selectEditList" resultType="map">
	/*selectEditList*/
	select post_id
	from post_list
	where ctgy_uuid='0b77eea3-d534-4201-b2e6-eef2605ce8a2'
	</select>
</mapper>